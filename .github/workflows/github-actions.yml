name: Portfolio Pipeline
on: [push]
jobs:
 Initial:
    runs-on: self-hosted
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: Pull Changes
        working-directory: /root/source/Portfolio-vm/
        run: |
         echo "ü§ì: Pulling changes to vm"
         git pull
      - name: Redeploy Portfolio API
        working-directory: /root/source/Portfolio-vm/Portfolio-Api/
        run: |
         echo "ü§ì: Refreshing API service"
         systemctl stop Portfolio-Api.service
         echo 'DbConnectionString=${{secrets.DB_CONNECTION_STRING}}' > env
         dotnet publish -c Release -o /srv/Portfolio-Api
         sudo cp Portfolio-Api.service /etc/systemd/system/Portfolio-Api.service
         systemctl daemon-reload
         systemctl start Portfolio-Api.service
      - name: Redeploy Docker Compose
        working-directory: /root/source/Portfolio-vm/
        run: |
         echo "ü§ì: Redeploying Docker-compose"
         docker-compose down
         docker-compose build
         docker-compose up -d
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
